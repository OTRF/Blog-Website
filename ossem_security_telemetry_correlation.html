<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>OSSEM Data Dictionaries: Correlating Security Telemetry</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Sharing and collaborating to empower the Infosec community!" />
    <link rel="shortcut icon" href="https://blog.openthreatresearch.com/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://blog.openthreatresearch.com/ossem_security_telemetry_correlation" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Open Threat Research Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="OSSEM Data Dictionaries: Correlating Security Telemetry" />
    <meta property="og:description" content="In this blogpost, we will share a basic use case on correlating security telemetry (Microsoft Security Auditing) through common data fields documented in OSSEM - Data Dictionaries. We will use original data field names to represent the interaction among security event logs. In addition, we will show how standardizing data" />
    <meta property="og:url" content="https://blog.openthreatresearch.com/ossem_security_telemetry_correlation" />
    <meta property="og:image" content="https://blog.openthreatresearch.com/assets/images/blog/ossem_correlating_events/2021-06-21_00_blog.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-06-21T08:00:00-04:00" />
    <meta property="article:modified_time" content="2021-06-21T08:00:00-04:00" />
    <meta property="article:tag" content="Ossem" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="OSSEM Data Dictionaries: Correlating Security Telemetry" />
    <meta name="twitter:description" content="In this blogpost, we will share a basic use case on correlating security telemetry (Microsoft Security Auditing) through common data fields documented in OSSEM - Data Dictionaries. We will use original data field names to represent the interaction among security event logs. In addition, we will show how standardizing data" />
    <meta name="twitter:url" content="https://blog.openthreatresearch.com/" />
    <meta name="twitter:image" content="https://blog.openthreatresearch.com/assets/images/blog/ossem_correlating_events/2021-06-21_00_blog.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Open Threat Research Blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Ossem" />
    <meta name="twitter:site" content="@OTR_Community" />
    <meta name="twitter:creator" content="@OTR_Community" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Open Threat Research Blog",
        "logo": "https://blog.openthreatresearch.com/false"
    },
    "url": "https://blog.openthreatresearch.com/ossem_security_telemetry_correlation",
    "image": {
        "@type": "ImageObject",
        "url": "https://blog.openthreatresearch.com/assets/images/blog/ossem_correlating_events/2021-06-21_00_blog.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.openthreatresearch.com/ossem_security_telemetry_correlation"
    },
    "description": "In this blogpost, we will share a basic use case on correlating security telemetry (Microsoft Security Auditing) through common data fields documented in OSSEM - Data Dictionaries. We will use original data field names to represent the interaction among security event logs. In addition, we will show how standardizing data"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="OSSEM Data Dictionaries: Correlating Security Telemetry" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://blog.openthreatresearch.com/">Open Threat Research Blog</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/getting-started/">Getting Started</a></li>
    <!--<li class="nav-try-ghost" role="menuitem"><a href="https://ghost.org">Try Ghost</a></li>-->
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/OTR_Community" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Subscribe</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-ossem post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="21 June 2021">21 June 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/ossem/'>OSSEM</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">OSSEM Data Dictionaries: Correlating Security Telemetry</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/blog/ossem_correlating_events/2021-06-21_00_blog.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>In this blogpost, we will share a basic use case on correlating security telemetry (<a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/advanced-security-audit-policy-settings">Microsoft Security Auditing</a>) through common data fields documented in <a href="https://github.com/OTRF/OSSEM-DD">OSSEM - Data Dictionaries</a>. We will use original data field names to represent the interaction among security event logs. In addition, we will show how standardizing data fields can help us to improve our analysis of security telemetry considering not only the number of telemetry providers, but also the network concept described by each data fields.</p>

<h1 id="pre-requisites">Pre-requisites</h1>

<h2 id="python-libraries-installation">Python Libraries Installation</h2>

<p>In order to use the</p>
<ul>
  <li><a href="https://github.com/OTRF/openhunt">Openhunt</a>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install openhunt
</code></pre></div>    </div>
  </li>
  <li><a href="https://pandas.pydata.org/pandas-docs/stable/index.html">Pandas</a>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install pandas
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="jupyter-notebook-available">Jupyter Notebook Available</h2>

<p>All the python code used in this blogpost will be available through a notebook <a href="https://ossemproject.com/dd/notebooks/security_events_correlation.html">here</a>, and you can use it as a reference to extend your analysis.</p>

<h1 id="ossem---data-dictionaries">OSSEM - Data Dictionaries</h1>

<h2 id="what-is-ossem">What is OSSEM?</h2>

<p>OSSEM stands for <code class="language-plaintext highlighter-rouge">Open Source Security Events Metadata</code>, and it is a community-led project that focuses primarily on the documentation and standardization of security event logs from diverse data sources and operating systems. Security events are documented in a <code class="language-plaintext highlighter-rouge">data dictionary (DD)</code> format, and they can be used as a reference while mapping data sources to data analytics used to validate the detection of adversarial techniques. In addition, the project provides a <code class="language-plaintext highlighter-rouge">common data model (CDM)</code> that can be used for data engineers during data normalization procedures to allow security analysts to query and analyze data across diverse data sources. Finally, the project also provides documentation about the structure and relationships identified in specific data sources to facilitate the development of data analytics and adversary behavior representation from a data perspective. These relationships are stored under the <code class="language-plaintext highlighter-rouge">detection model (DM)</code> section of the project.</p>

<p><img src="assets/images/blog/ossem_correlating_events/2021-06-21_01_ossem_components.png" alt="" /></p>

<h2 id="what-is-a-data-dictionary">What is a Data Dictionary?</h2>

<p>Data Dictionaries are structures that can help us to get a better understanding of the security context provided by security telemetry. Most of the metadata within a dictionary is obtained directly from telemtry providers documentation. In addition, the OSSEM project extends the content of data dictionaries with metadata such as the <code class="language-plaintext highlighter-rouge">standard name</code> for an event field, <code class="language-plaintext highlighter-rouge">references</code> and <code class="language-plaintext highlighter-rouge">tags</code>. <a href="https://github.com/OTRF/OSSEM-DD">OSSEM data dictionaries</a> are stored in an easy to consume format such as <code class="language-plaintext highlighter-rouge">yaml</code>. Here is an example of a data dictionary for <a href="https://github.com/OTRF/OSSEM-DD/blob/main/windows/sysmon/events/event-1.yml">Sysmon event 1 (Process Creation)</a>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Event</span><span class="nv"> </span><span class="s">ID</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Process</span><span class="nv"> </span><span class="s">creation'</span>
<span class="na">description</span><span class="pi">:</span> <span class="s">The **process creation** event provides extended information about a newly created process.</span>
<span class="na">platform</span><span class="pi">:</span> <span class="s">windows</span>
<span class="na">log_source</span><span class="pi">:</span> <span class="s">sysmon</span>
<span class="na">event_code</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1'</span>
<span class="na">event_version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.32'</span>
<span class="na">event_fields</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">standard_name</span><span class="pi">:</span> <span class="s">process_guid</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ProcessGuid</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">Process Guid of the process that got spawned/created (child)</span>
  <span class="na">sample_value</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{A98268C1-9C2E-5ACD-0000-0010396CAB00}'</span>
<span class="pi">-</span> <span class="na">standard_name</span><span class="pi">:</span> <span class="s">user_logon_id</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">LogonId</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">Login ID of the user who created the new process.</span>
  <span class="na">sample_value</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0xf6219'</span>
<span class="na">references</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">text</span><span class="pi">:</span> <span class="s">Sysmon Source</span>
  <span class="na">link</span><span class="pi">:</span> <span class="s">https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon#event-id-1-process-creation</span>
<span class="na">tags</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">Windows</span>
</code></pre></div></div>

<h2 id="why-do-we-need-data-dictionaries">Why do we need Data Dictionaries?</h2>

<p>A data dictionary is not just a collection of data provided by a security application. In fact, the main goal of documenting security telemetry is to understand the activity in our network environment that triggered the generation of data. In addition, we need to identify network concepts such as a <code class="language-plaintext highlighter-rouge">user</code> or <code class="language-plaintext highlighter-rouge">process</code> that are represented and described by every data field.</p>

<h2 id="why-do-we-need-standard-names">Why do we need Standard Names?</h2>

<p>One of the most helpful features provided by OSSEM data dictionaries is the standardization of data fields names. This can help us to correlate telemetry not only among data schemas provided by a specific security application, but also among data schemas from different telemetry providers such as <code class="language-plaintext highlighter-rouge">Security Auditing</code>, <code class="language-plaintext highlighter-rouge">Sysmon</code>, and <code class="language-plaintext highlighter-rouge">OSQuery</code>.</p>

<h1 id="correlating-security-telemetry">Correlating Security Telemetry</h1>

<p>One of the benefits of documenting and standardizing security telemetry is that we can correlate it based on data fields such as <code class="language-plaintext highlighter-rouge">ProcessGuid</code> and <code class="language-plaintext highlighter-rouge">LogonId</code>. The correlation process might be easier when working with security telemetry provided by a single provider. On the other hand, working with data from different telemetry providers might be more difficult because of the different name syntax used by each provider. Indeed, for this type of use cases is where the standardization feature of OSSEM data dictionaries becomes more relevant.</p>

<h2 id="microsoft-security-auditing-telemetry-correlation">Microsoft Security Auditing Telemetry Correlation</h2>

<p><strong>a) Collecting data dictionaries content</strong></p>

<p>We are going to use the <a href="https://github.com/OTRF/openhunt/blob/master/openhunt/ossem.py">ossem module</a> from Openhunt (Python library) to collect data dictionaries content for Security Auditing telemetry provider. By running the following code, you should be able to get a list with all the yaml files’ names for data dictionaries, collect its content, and represent it as a <code class="language-plaintext highlighter-rouge">Pandas dataframe</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Importing Python libraries
</span><span class="kn">from</span> <span class="nn">openhunt</span> <span class="kn">import</span> <span class="n">ossem</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">pd</span><span class="p">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_colwidth'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="c1"># Getting a Python list with dictionaries' names
</span><span class="n">security_auditing_events</span> <span class="o">=</span> <span class="n">ossem</span><span class="p">.</span><span class="n">getDictionaryName</span><span class="p">(</span><span class="s">'Windows'</span><span class="p">,</span><span class="s">'Security'</span><span class="p">)</span>
<span class="c1"># Getting OSSEM dictionaries content (summary view)
</span><span class="n">security_auditing_dictionaries</span> <span class="o">=</span> <span class="n">ossem</span><span class="p">.</span><span class="n">getDictionaryContent</span><span class="p">(</span><span class="s">'Windows'</span><span class="p">,</span><span class="s">'Security'</span><span class="p">,</span><span class="n">security_auditing_events</span><span class="p">,</span><span class="n">view</span> <span class="o">=</span> <span class="s">'summary'</span><span class="p">)</span>
<span class="c1"># Example of dictionary content
</span><span class="n">security_auditing_dictionaries</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="assets/images/blog/ossem_correlating_events/2021-06-21_02_security_auditing_dictionaries.png" alt="" /></p>

<p><strong>b) Identifying security events that contain the same data field: LogonType</strong></p>

<p>Let’s say we are analyzing event <strong><a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4624">4624</a></strong> (An account was successfully logged on). An interesting data field provided by this event is <code class="language-plaintext highlighter-rouge">LogonType</code>. This data field can take values such as 2 (Interactive) and 3 (Network). In fact, a LogonType field with value 3 might be an indicator of an adversary performing lateral movement techniques.</p>

<p>As a security person you might be interested on other security events provide the same data field. By running the following code, you should be able to identify all Security Auditing events that provide security context around the LogonType data field by filtering our Pandas dataframe.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">security_auditing_dictionaries</span><span class="p">[</span><span class="n">security_auditing_dictionaries</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'LogonType'</span><span class="p">]</span>
</code></pre></div></div>

<p><img src="assets/images/blog/ossem_correlating_events/2021-06-21_03_logontype_events.png" alt="" /></p>

<p><strong>c) Adding more security context: LogonType and TagertLogonId</strong></p>

<p>Let’s continue adding more security context to our analysis by using other data fields from event 4624. I previously mentioned that LogonType field with value 3 gives us security context of an account logging on a computer over the network (remotely), but what is the account that performed this operation? Event 4624 gives us that information through different data fields such as <code class="language-plaintext highlighter-rouge">TargetLogonId</code>. By running the following code, you should be able to identify all Security Auditing events that provide security context around LogonType and TargetLogonId data fields by filtering our Pandas dataframe.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">security_auditing_dictionaries</span><span class="p">[(</span><span class="n">security_auditing_dictionaries</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'LogonType'</span><span class="p">)</span> <span class="o">|</span> \
                               <span class="p">(</span><span class="n">security_auditing_dictionaries</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'TargetLogonId'</span><span class="p">)]</span>
</code></pre></div></div>

<p><img src="assets/images/blog/ossem_correlating_events/2021-06-21_04_logontype_targetlogonid.png" alt="" /></p>

<p><strong>d) Visualizing  relationships among security events and data fields in a network graph</strong></p>

<p>Even though the image above shows us all the Security Auditing events that contain the <code class="language-plaintext highlighter-rouge">LogonType</code> and <code class="language-plaintext highlighter-rouge">TargetLogonId</code> fields, sometimes it is easier to visualize this information as a network graph. By running the following code, you should be able to create a network graph to visualize the interaction among security events and data fields.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ossem</span><span class="p">.</span><span class="n">event_to_field_network</span><span class="p">(</span><span class="n">data_fields</span><span class="p">,</span><span class="nb">type</span> <span class="o">=</span> <span class="s">'original'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="assets/images/blog/ossem_correlating_events/2021-06-21_05_network_graph.png" alt="" /></p>

<p>The image above gives us a network representation of the interaction among security events and its data fields. For instance, just by using the <code class="language-plaintext highlighter-rouge">TargetLogonId</code> data field, we know that security events <strong><a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4624">4624</a></strong> (An account was successfully logged on) and <strong><a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4688">4688</a></strong> (A new process has been created) shared a common data field.</p>

<p><img src="assets/images/blog/ossem_correlating_events/2021-06-21_06_network_graph_annotation.png" alt="" /></p>

<p>Although these security events, <code class="language-plaintext highlighter-rouge">4624</code> and <code class="language-plaintext highlighter-rouge">4688</code>, share the <code class="language-plaintext highlighter-rouge">TargetLogonId</code> data field, we also need to validate that the concept represented by this data field is the same in both security events. Unfortunately, this is not the case for our example. In event 4688, the data field that represents the account that requested the creation of a process is <strong>SubjectLogonId</strong>, not <code class="language-plaintext highlighter-rouge">TargetLogonId</code>.</p>

<p><strong>e) Using standard names to represent the right network concept among security events</strong></p>

<p>After reviewing our previous example, we can conclude that sharing the same data field does not guarantee the representation of the same network concept among security events. That is why it is important for organizations to define a standardization process based on their understanding of the data collected. The <a href="https://github.com/OTRF/OSSEM-DD">OSSEM-DD</a> component provides standard names for data fields of several security telemetry sources. It is still a work in progress, but we encourage the InfoSec community to take a look at it, test it, and collaborate with us to improve this process.</p>

<p>Let’s replicate our previous network graph, but we are going to use the <code class="language-plaintext highlighter-rouge">standard names</code> of data fields this time. By running the following code, you should be able to create a network graph to visualize the interaction among security events and standard data fields considering the standard names for <code class="language-plaintext highlighter-rouge">LogonType</code>, <code class="language-plaintext highlighter-rouge">TargetLogonId</code>, and <code class="language-plaintext highlighter-rouge">SubjectLogonId</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Getting a list of event_id used in our previous network graph
</span><span class="n">event_for_graph</span> <span class="o">=</span> <span class="n">data_fields</span><span class="p">[</span><span class="s">'event_id'</span><span class="p">].</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># Adding 'SubjectLogonId' data field to the filer
</span><span class="n">data_fields_2</span> <span class="o">=</span> <span class="n">security_auditing_dictionaries</span><span class="p">[((</span><span class="n">security_auditing_dictionaries</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'LogonType'</span><span class="p">)</span> <span class="o">|</span> \
                                               <span class="p">(</span><span class="n">security_auditing_dictionaries</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'TargetLogonId'</span><span class="p">)</span> <span class="o">|</span> \
                                               <span class="p">(</span><span class="n">security_auditing_dictionaries</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'SubjectLogonId'</span><span class="p">))</span> \
                                               <span class="o">&amp;</span> <span class="p">(</span><span class="n">security_auditing_dictionaries</span><span class="p">[</span><span class="s">'event_id'</span><span class="p">].</span><span class="n">isin</span><span class="p">(</span><span class="n">event_for_graph</span><span class="p">))]</span>
<span class="c1"># Creating network graph using standard names
</span><span class="n">ossem</span><span class="p">.</span><span class="n">event_to_field_network</span><span class="p">(</span><span class="n">data_fields_2</span><span class="p">,</span><span class="nb">type</span> <span class="o">=</span> <span class="s">'standard'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="assets/images/blog/ossem_correlating_events/2021-06-21_07_network_graph_standard_names.png" alt="" /></p>

<p>As you can see in the image above, the link between secuity events 4624 and 4688 can be defined through the standard data field <strong>user_logon_id</strong> (represented by <code class="language-plaintext highlighter-rouge">TargetLogonId</code> in 4624 and <code class="language-plaintext highlighter-rouge">SubjectLogonId</code> in 4688) and not <strong>target_user_logon_id</strong>.</p>

<h1 id="what-are-the-next-steps-regarding-data-dictionaries">What Are The Next Steps Regarding Data Dictionaries?</h1>

<p>When we started the standardazitaion process for OSSEM - Data Dictioanries, we considered every security event having a unique standard structure. However, while performing research activities at <a href="https://blog.openthreatresearch.com/">Open Threat Research (OTR)</a>, we realized that, in some cases, the standard structure of some events may change based on the values of some data fields.</p>

<p>For example, let’s take a look at the standard structure of security event <strong><a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4656">4656</a></strong> (A handle to an object was requested).</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Event</span><span class="nv"> </span><span class="s">ID</span><span class="nv"> </span><span class="s">4656:</span><span class="nv"> </span><span class="s">A</span><span class="nv"> </span><span class="s">handle</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">object</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">requested'</span>
<span class="na">description</span><span class="pi">:</span> <span class="s">This event indicates that specific access was requested for an object.</span>
  <span class="s">The object could be a file system, kernel, or registry object, or a file system</span>
  <span class="s">object on removable storage or a device.</span>
<span class="na">platform</span><span class="pi">:</span> <span class="s">windows</span>
<span class="na">log_source</span><span class="pi">:</span> <span class="s">Microsoft-Windows-Security-Auditing</span>
<span class="na">event_code</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4656'</span>
<span class="na">event_version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1'</span>
<span class="na">event_fields</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">standard_name</span><span class="pi">:</span> <span class="s">user_logon_id</span>
  <span class="na">standard_type</span><span class="pi">:</span> <span class="s">TBD</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">SubjectLogonId</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">HexInt64</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">hexadecimal value that can help you correlate this event with recent</span>
    <span class="s">events that might contain the same Logon ID</span>
  <span class="na">sample_value</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0x4367b'</span>
<span class="pi">-</span> <span class="na">standard_name</span><span class="pi">:</span> <span class="s">object_type</span>
  <span class="na">standard_type</span><span class="pi">:</span> <span class="s">TBD</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ObjectType</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">UnicodeString</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">The type of an object that was accessed during the operation.</span>
  <span class="na">sample_value</span><span class="pi">:</span> <span class="s">File</span>
<span class="pi">-</span> <span class="na">standard_name</span><span class="pi">:</span> <span class="s">object_name</span>
  <span class="na">standard_type</span><span class="pi">:</span> <span class="s">TBD</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ObjectName</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">UnicodeString</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">name and other identifying information for the object for which access</span>
    <span class="s">was requested. For example, for a file, the path would be included.</span>
  <span class="na">sample_value</span><span class="pi">:</span> <span class="s">C:\Documents\HBI Data.txt</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">ObjectType</code> data field can take values that make reference to different types of objects such as a file (File), a windows registry key (Key), and a process (Process). These different values can impact the standard name of the <code class="language-plaintext highlighter-rouge">ObjectName</code> data field. Currently, the standard name for this value is <code class="language-plaintext highlighter-rouge">object_name</code>. However, it could change, for example, to <code class="language-plaintext highlighter-rouge">file_name</code> or <code class="language-plaintext highlighter-rouge">registry_path</code>.</p>

<p>We have created a new project within OTR, <strong>OSSEM-DD-MASK</strong>, which will be and extension of the OSSEM-DD project and where we will document all the potential standard structures variations for different security events. This initiative is led by OTR community member <a href="https://twitter.com/hxnoyd">Ricardo Dias</a>. I will share more details about this in a future blogpost.</p>

<h1 id="references">References</h1>
<ul>
  <li><a href="https://github.com/OTRF/OSSEM/blob/master/docs/dd/security_telemetry_correlation/security_events_correlation.ipynb">Jupyter Notebook related to this blog</a></li>
  <li><a href="https://github.com/OTRF/OSSEM-DD">OSSEM - Data Dictionaries Project GitHub Repository</a></li>
  <li><a href="https://ossemproject.com/intro.html">OSSEM Website</a></li>
</ul>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Open Threat Research Blog</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

                </section>
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/authors/avatar-jose.jpg" alt="jose" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/jose">Jose Rodriguez</a></h4>
                                
                                    <p>Security Researcher</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/jose">Read More</a>
                        </div>
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            
                                style="background-image: url(url(/assets/images/blog/ossem_correlating_events/2021-06-21_00_blog.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Open Threat Research Blog &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/ossem/">Ossem</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ossem_generation_xpath_queries">OSSEM Detection Model: Leveraging Data Relationships to Generate Windows Event XPath Queries</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/ossem/">
                                
                                    See all 1 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/ossem_generation_xpath_queries">
                <div class="post-card-image" style="background-image: url(/assets/images/blog/ossem_creating_xpath_queries/2021-06-22_00_blog_image.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/ossem_generation_xpath_queries">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Ossem</span>
                            
                        
                    

                    <h2 class="post-card-title">OSSEM Detection Model: Leveraging Data Relationships to Generate Windows Event XPath Queries</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/authors/avatar-jose.jpg" alt="Jose Rodriguez" />
                        
                        <span class="post-card-author">
                            <a href="/author/jose/">Jose Rodriguez</a>
                        </span>
                    
                
                    
                
                    
                
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/apt-simulator-cobalt-strike-beacon">
                <div class="post-card-image" style="background-image: url(/assets/images/blog/cobalt_strike_beacon_simulation/2021-06-14_00_APTSimulator_blogpost_image.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/apt-simulator-cobalt-strike-beacon">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Cobalt-strike</span>
                            
                        
                            
                                <span class="post-card-tags">Mordor</span>
                            
                        
                    

                    <h2 class="post-card-title">Simulating Cobalt Strike Beacon Activity</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/authors/avatar-jose.jpg" alt="Jose Rodriguez" />
                        
                        <span class="post-card-author">
                            <a href="/author/jose/">Jose Rodriguez</a>
                        </span>
                    
                
                    
                
                    
                
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://blog.openthreatresearch.com/">
            
                <img src="/assets/images/favicon.png" alt="Open Threat Research Blog icon" />
            
            <span>Open Threat Research Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">OSSEM Data Dictionaries: Correlating Security Telemetry</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=OSSEM+Data+Dictionaries%3A+Correlating+Security+Telemetry&amp;url=ossem_security_telemetry_correlation"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=ossem_security_telemetry_correlation"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://blog.openthreatresearch.com/">Open Threat Research Blog</a> &copy; 2021</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    <a href="https://twitter.com/OTR_Community" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Subscribe to Open Threat Research Blog</h1>
                <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
                <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
